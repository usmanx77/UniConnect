import{j as e,z as Ve,A as Qe,B as Xe,E as He,G as Je,r as c,H as Ye,J as Ze,K as es,L as ss,M as as,N as ts}from"./radix-vendor-0isRFci2.js";import{f as G,B as i,I as B,S as ke,i as ne,j as ie,D as Se,c as Me,d as _e,e as Ee,A as V,a as Q,h as se,k as Y,T as rs}from"./index-BIbJj-LN.js";import{X as F,q as U,$ as ns,I as is,a0 as le,a1 as ls,a2 as cs,a3 as os,n as Z,a4 as Ne,a5 as ze,P as ve,a6 as ds,x as ce,B as ee,a7 as Ae,a8 as ms,a9 as hs,s as xs,r as us,aa as fs,ab as js,ac as oe,f as te,A as Fe,ad as Te,ae as re,af as W,z as Re,Y as Ie,v as ps,ag as gs,ah as Ns,ai as vs}from"./ui-vendor-DodV2HUK.js";import{S as H}from"./switch-U6SdRot_.js";import{c as ws}from"./supabase-vendor-F5gKsx73.js";import{f as de}from"./date-vendor-CuSz-XOp.js";import"./react-vendor-BWX1YzKK.js";import"./motion-vendor-BozBRtxF.js";import"./form-vendor-CvzR2AkN.js";function $({...o}){return e.jsx(Ve,{"data-slot":"dropdown-menu",...o})}function O({...o}){return e.jsx(Qe,{"data-slot":"dropdown-menu-trigger",...o})}function L({className:o,sideOffset:t=4,...s}){return e.jsx(Xe,{children:e.jsx(He,{"data-slot":"dropdown-menu-content",sideOffset:t,className:G("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",o),...s})})}function M({className:o,inset:t,variant:s="default",...d}){return e.jsx(Je,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":s,className:G("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),...d})}const we=[{name:"Smileys & People",emojis:["😀","😃","😄","😁","😆","😅","🤣","😂","🙂","🙃","😉","😊","😇","🥰","😍","🤩","😘","😗","😚","😙","😋","😛","😜","🤪","😝","🤑","🤗","🤭","🤫","🤔","🤐","🤨","😐","😑","😶","😏","😒","🙄","😬","🤥","😔","😪","🤤","😴","😷","🤒","🤕","🤢","🤮","🤧","🥵","🥶","🥴","😵","🤯","🤠","🥳","😎","🤓","🧐","😕","😟","🙁","☹️","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","🥱","😤","😡","😠","🤬","😈","👿","💀","☠️","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾"]},{name:"Animals & Nature",emojis:["🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","🦁","🐮","🐷","🐸","🐵","🙈","🙉","🙊","🐒","🐔","🐧","🐦","🐤","🐣","🐥","🦆","🦅","🦉","🦇","🐺","🐗","🐴","🦄","🐝","🐛","🦋","🐌","🐞","🐜","🦟","🦗","🕷️","🕸️","🦂","🐢","🐍","🦎","🦖","🦕","🐙","🦑","🦐","🦞","🦀","🐡","🐠","🐟","🐬","🐳","🐋","🦈","🐊","🐅","🐆","🦓","🦍","🐘","🦛","🦏","🐪","🐫","🦒","🦘","🐃","🐂","🐄","🐎","🐖","🐏","🐑","🦙","🐐","🦌","🐕","🐩","🦮","🐕‍🦺","🐈","🐓","🦃","🦚","🦜","🦢","🦩","🕊️","🐇","🦝","🦨","🦡","🦦","🦥","🐁","🐀","🐿️","🦔"]},{name:"Food & Drink",emojis:["🍎","🍐","🍊","🍋","🍌","🍉","🍇","🍓","🫐","🍈","🍒","🍑","🥭","🍍","🥥","🥝","🍅","🍆","🥑","🥦","🥬","🥒","🌶️","🫒","🌽","🥕","🫑","🥔","🍠","🥐","🥖","🍞","🥨","🥯","🧀","🥚","🍳","🧈","🥞","🧇","🥓","🥩","🍗","🍖","🦴","🌭","🍔","🍟","🍕","🫓","🥙","🌮","🌯","🫔","🥗","🥘","🫕","🥫","🍝","🍜","🍲","🍛","🍣","🍱","🥟","🦪","🍤","🍙","🍚","🍘","🍥","🥠","🥮","🍢","🍡","🍧","🍨","🍦","🥧","🧁","🍰","🎂","🍮","🍭","🍬","🍫","🍿","🍩","🍪","🌰","🥜","🍯"]},{name:"Activities",emojis:["⚽","🏀","🏈","⚾","🥎","🎾","🏐","🏉","🎱","🪀","🏓","🏸","🏒","🏑","🥍","🏏","🪃","🥅","⛳","🪁","🏹","🎣","🤿","🥊","🥋","🎽","🛹","🛷","⛸️","🥌","🎿","⛷️","🏂","🪂","🏋️‍♀️","🏋️","🏋️‍♂️","🤼‍♀️","🤼","🤼‍♂️","🤸‍♀️","🤸","🤸‍♂️","⛹️‍♀️","⛹️","⛹️‍♂️","🤺","🤾‍♀️","🤾","🤾‍♂️","🏌️‍♀️","🏌️","🏌️‍♂️","🏇","🧘‍♀️","🧘","🧘‍♂️","🏄‍♀️","🏄","🏄‍♂️","🏊‍♀️","🏊","🏊‍♂️","🤽‍♀️","🤽","🤽‍♂️","🚣‍♀️","🚣","🚣‍♂️","🧗‍♀️","🧗","🧗‍♂️","🚵‍♀️","🚵","🚵‍♂️","🚴‍♀️","🚴","🚴‍♂️","🏆","🥇","🥈","🥉","🏅","🎖️","🏵️","🎗️","🎫","🎟️","🎪","🤹","🤹‍♀️","🤹‍♂️","🎭","🩰","🎨","🎬","🎤","🎧","🎼","🎵","🎶","🪘","🥁","🎹","🎷","🎺","🎸","🪕","🎻","🎲","♠️","♥️","♦️","♣️","♟️","🃏","🀄","🎴","🎯","🎳","🎮","🕹️","🎰","🧩"]},{name:"Travel & Places",emojis:["🚗","🚕","🚙","🚌","🚎","🏎️","🚓","🚑","🚒","🚐","🛻","🚚","🚛","🚜","🏍️","🛵","🏎️","🚨","🚔","🚍","🚘","🚖","🚡","🚠","🚟","🚃","🚋","🚞","🚝","🚄","🚅","🚈","🚂","🚆","🚇","🚊","🚉","✈️","🛫","🛬","🛩️","💺","🛰️","🚀","🛸","🚁","🛶","⛵","🚤","🛥️","🛳️","⛴️","🚢","⚓","🚧","⛽","🚨","🚥","🚦","🛑","🚏","🗺️","🗿","🗽","🗼","🏰","🏯","🏟️","🎡","🎢","🎠","⛲","⛱️","🏖️","🏝️","🏔️","⛰️","🌋","🗻","🏕️","⛺","🛖","🏠","🏡","🏘️","🏚️","🏗️","🏭","🏢","🏬","🏣","🏤","🏥","🏦","🏨","🏪","🏫","🏩","💒","🏛️","⛪","🕌","🕍","🛕","🕋","⛩️","🛤️","🛣️","🗾","🎑","🏞️","🌅","🌄","🌠","🎇","🎆","🌇","🌆","🏙️","🌃","🌌","🌉","🌁"]},{name:"Objects",emojis:["⌚","📱","📲","💻","⌨️","🖥️","🖨️","🖱️","🖲️","🕹️","🗜️","💽","💾","💿","📀","📼","📷","📸","📹","🎥","📽️","🎞️","📞","☎️","📟","📠","📺","📻","🎙️","🎚️","🎛️","🧭","⏱️","⏲️","⏰","🕰️","⌛","⏳","📡","🔋","🔌","💡","🔦","🕯️","🪔","🧯","🛢️","💸","💵","💴","💶","💷","🪙","💰","💳","💎","⚖️","🪜","🧰","🔧","🔨","⚒️","🛠️","⛏️","🪓","🪚","🔩","⚙️","🪤","🧱","⛓️","🧲","🔫","💣","🧨","🪓","🔪","🗡️","⚔️","🛡️","🚬","⚰️","🪦","⚱️","🏺","🔮","📿","🧿","💈","⚗️","🔭","🔬","🕳️","🩹","🩺","💊","💉","🩸","🧬","🦠","🧫","🧪","🌡️","🧹","🧺","🧻","🚽","🚰","🚿","🛁","🛀","🧼","🪒","🧴","🧷","🧹","🧺","🧻","🚽","🚰","🚿","🛁","🛀","🧼","🪒","🧴","🧷","🧹","🧺","🧻","🚽","🚰","🚿","🛁","🛀","🧼","🪒","🧴","🧷"]}];function bs({onEmojiSelect:o,onClose:t}){const[s,d]=c.useState(""),[x,f]=c.useState(0),g=we.map(u=>({...u,emojis:u.emojis.filter(N=>N.includes(s)||u.name.toLowerCase().includes(s.toLowerCase()))})).filter(u=>u.emojis.length>0),p=u=>{o(u)};return e.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-lg p-4 w-80 max-h-96",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Choose an emoji"}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:t,children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{type:"text",placeholder:"Search emojis...",value:s,onChange:u=>d(u.target.value),className:"pl-10 h-8"})]}),e.jsx("div",{className:"flex gap-1 mb-3 overflow-x-auto",children:we.map((u,N)=>e.jsx(i,{variant:x===N?"default":"ghost",size:"sm",className:"text-xs whitespace-nowrap",onClick:()=>f(N),children:u.name},N))}),e.jsx(ke,{className:"h-48",children:e.jsx("div",{className:"grid grid-cols-8 gap-1",children:g[x]?.emojis.map((u,N)=>e.jsx(i,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg hover:bg-accent",onClick:()=>p(u),children:u},N))})})]})}function ys({className:o,value:t,...s}){return e.jsx(Ye,{"data-slot":"progress",className:G("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",o),...s,children:e.jsx(Ze,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}const Cs=10*1024*1024,be=["image/jpeg","image/png","image/gif","image/webp","video/mp4","video/webm","video/quicktime","audio/mp3","audio/wav","audio/ogg","application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"];function ks({onFilesSelect:o,onClose:t}){const[s,d]=c.useState([]),[x,f]=c.useState(!1),[g,p]=c.useState(0),u=c.useRef(null),N=h=>{const l=Array.from(h.target.files||[]).filter(m=>m.size>Cs?(alert(`File ${m.name} is too large. Maximum size is 10MB.`),!1):be.includes(m.type)?!0:(alert(`File type ${m.type} is not supported.`),!1));d(m=>[...m,...l])},C=h=>{d(v=>v.filter((l,m)=>m!==h))},k=async()=>{if(s.length!==0){f(!0),p(0);try{const h=setInterval(()=>{p(v=>v>=90?(clearInterval(h),v):v+10)},100);await new Promise(v=>setTimeout(v,1e3)),clearInterval(h),p(100),o(s),d([]),f(!1),p(0)}catch(h){console.error("Upload failed:",h),f(!1),p(0)}}},w=h=>h.type.startsWith("image/")?e.jsx(is,{className:"h-4 w-4"}):h.type.startsWith("video/")?e.jsx(le,{className:"h-4 w-4"}):h.type.startsWith("audio/")?e.jsx(ls,{className:"h-4 w-4"}):h.type.includes("pdf")||h.type.includes("text")?e.jsx(cs,{className:"h-4 w-4"}):e.jsx(os,{className:"h-4 w-4"}),E=h=>{if(h===0)return"0 Bytes";const v=1024,l=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(h)/Math.log(v));return parseFloat((h/Math.pow(v,m)).toFixed(2))+" "+l[m]};return e.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-lg p-4 w-80",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Upload Files"}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:t,children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center cursor-pointer hover:border-muted-foreground/50 transition-colors",onClick:()=>u.current?.click(),children:[e.jsx(ns,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Click to select files or drag and drop"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max 10MB per file"})]}),e.jsx("input",{ref:u,type:"file",multiple:!0,accept:be.join(","),onChange:N,className:"hidden"}),s.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-xs font-medium text-muted-foreground",children:["Selected Files (",s.length,")"]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:s.map((h,v)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-lg",children:[w(h),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium truncate",children:h.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E(h.size)})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>C(v),children:e.jsx(F,{className:"h-3 w-3"})})]},v))})]}),x&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[g,"%"]})]}),e.jsx(ys,{value:g,className:"h-2"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",className:"flex-1",onClick:t,disabled:x,children:"Cancel"}),e.jsx(i,{size:"sm",className:"flex-1",onClick:k,disabled:s.length===0||x,children:x?"Uploading...":`Upload ${s.length} file${s.length!==1?"s":""}`})]})]})]})}function Ss({roomId:o,isOpen:t,onClose:s}){const{user:d}=ne(),{rooms:x,createRoom:f}=ie(),[g,p]=c.useState(""),[u,N]=c.useState(!1),[C,k]=c.useState(""),[w,E]=c.useState([]),h=x.find(r=>r.id===o),v=h?.members.find(r=>r.userId===d?.id&&r.role==="admin"),l=[{id:"1",name:"Alice Johnson",avatar:"",department:"Computer Science",isOnline:!0},{id:"2",name:"Bob Smith",avatar:"",department:"Engineering",isOnline:!1},{id:"3",name:"Carol Davis",avatar:"",department:"Mathematics",isOnline:!0},{id:"4",name:"David Wilson",avatar:"",department:"Physics",isOnline:!0},{id:"5",name:"Eva Brown",avatar:"",department:"Chemistry",isOnline:!1}],m=l.filter(r=>r.name.toLowerCase().includes(g.toLowerCase())&&!h?.members.some(S=>S.userId===r.id)),_=async()=>{if(!(!C.trim()||w.length===0))try{await f({roomType:"group",name:C,memberIds:w}),k(""),E([]),N(!1)}catch(r){console.error("Failed to create group:",r)}},T=async r=>{console.log("Remove member:",r)},b=async r=>{console.log("Promote to admin:",r)},z=r=>{E(S=>S.includes(r)?S.filter(R=>R!==r):[...S,r])};return e.jsx(Se,{open:t,onOpenChange:s,children:e.jsxs(Me,{className:"max-w-2xl max-h-[80vh] overflow-hidden",children:[e.jsx(_e,{children:e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),u?"Create Group Chat":"Group Members"]})}),e.jsx("div",{className:"space-y-4",children:u?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Group Name"}),e.jsx(B,{value:C,onChange:r=>k(r.target.value),placeholder:"Enter group name...",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Add Members"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search users...",value:g,onChange:r=>p(r.target.value),className:"pl-10"})]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:m.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-accent cursor-pointer",onClick:()=>z(r.id),children:[e.jsx("input",{type:"checkbox",checked:w.includes(r.id),onChange:()=>z(r.id),className:"rounded"}),e.jsx(V,{className:"h-8 w-8",children:e.jsx(Q,{className:"bg-primary text-white text-xs",children:r.name.charAt(0)})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.department})]}),r.isOnline&&e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"})]},r.id))}),w.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium mb-2",children:["Selected Members (",w.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(r=>{const S=l.find(R=>R.id===r);return S?e.jsxs(se,{variant:"secondary",className:"flex items-center gap-1",children:[S.name,e.jsx(F,{className:"h-3 w-3 cursor-pointer",onClick:()=>z(r)})]},r):null})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>N(!1),className:"flex-1",children:"Cancel"}),e.jsx(i,{onClick:_,disabled:!C.trim()||w.length===0,className:"flex-1",children:"Create Group"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:h?.members.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-accent",children:[e.jsxs(V,{className:"h-10 w-10",children:[e.jsx(Y,{src:r.avatarUrl}),e.jsx(Q,{className:"bg-primary text-white",children:r.name.charAt(0)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium",children:r.name}),r.role==="admin"&&e.jsx(Ne,{className:"h-4 w-4 text-primary"}),r.role==="owner"&&e.jsx(ze,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.isOnline?"Online":"Offline"})]}),v&&r.userId!==d?.id&&e.jsxs($,{children:[e.jsx(O,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ve,{className:"h-4 w-4"})})}),e.jsxs(L,{align:"end",children:[e.jsxs(M,{onClick:()=>b(r.userId),children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Promote to Admin"]}),e.jsxs(M,{onClick:()=>T(r.userId),className:"text-destructive",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Remove Member"]})]})]})]},r.userId))}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsxs(i,{variant:"outline",onClick:()=>N(!0),className:"flex-1",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Create New Group"]}),e.jsx(i,{variant:"outline",onClick:s,className:"flex-1",children:"Close"})]})]})})]})})}function Ms({className:o,defaultValue:t,value:s,min:d=0,max:x=100,...f}){const g=c.useMemo(()=>Array.isArray(s)?s:Array.isArray(t)?t:[d,x],[s,t,d,x]);return e.jsxs(es,{"data-slot":"slider",defaultValue:t,value:s,min:d,max:x,className:G("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",o),...f,children:[e.jsx(ss,{"data-slot":"slider-track",className:G("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(as,{"data-slot":"slider-range",className:G("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:g.length},(p,u)=>e.jsx(ts,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},u))]})}function _s({roomId:o,isOpen:t,onClose:s}){const[d,x]=c.useState(!0),[f,g]=c.useState(!0),[p,u]=c.useState([70]),[N,C]=c.useState(!1),[k,w]=c.useState(null),E=[{label:"1 hour",value:"1h"},{label:"8 hours",value:"8h"},{label:"24 hours",value:"24h"},{label:"1 week",value:"1w"},{label:"Forever",value:"forever"}],h=b=>{if(b==="forever")w("forever");else{const z=new Date,r=b==="1h"?1:b==="8h"?8:b==="24h"?24:168,S=new Date(z.getTime()+r*60*60*1e3);w(S.toISOString())}},v=()=>{w(null)},l=()=>{console.log("Export chat:",o)},m=()=>{console.log("Archive chat:",o)},_=()=>{confirm("Are you sure you want to delete this chat? This action cannot be undone.")&&console.log("Delete chat:",o)},T=()=>{if(!k)return null;if(k==="forever")return"Muted forever";const b=new Date(k),z=new Date;if(b>z){const r=b.getTime()-z.getTime();return`Muted for ${Math.ceil(r/(1e3*60*60))} more hours`}return null};return e.jsx(Se,{open:t,onOpenChange:s,children:e.jsxs(Me,{className:"max-w-md",children:[e.jsx(_e,{children:e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Chat Settings"]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Notifications"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d?e.jsx(ee,{className:"h-4 w-4"}):e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Enable notifications"})]}),e.jsx(H,{checked:d,onCheckedChange:x})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[f?e.jsx(ms,{className:"h-4 w-4"}):e.jsx(hs,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Sound notifications"})]}),e.jsx(H,{checked:f,onCheckedChange:g})]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Volume"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[p[0],"%"]})]}),e.jsx(Ms,{value:p,onValueChange:u,max:100,step:1,className:"w-full"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Mute chat"}),e.jsxs($,{children:[e.jsx(O,{asChild:!0,children:e.jsx(i,{variant:"outline",size:"sm",children:T()?T():"Mute"})}),e.jsxs(L,{align:"end",children:[E.map(b=>e.jsx(M,{onClick:()=>h(b.value),children:b.label},b.value)),k&&e.jsx(M,{onClick:v,children:"Unmute"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Appearance"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[N?e.jsx(xs,{className:"h-4 w-4"}):e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Dark mode"})]}),e.jsx(H,{checked:N,onCheckedChange:C})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Privacy & Security"}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"End-to-end encryption"}),e.jsx(se,{variant:"secondary",className:"text-xs",children:"Enabled"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Show online status"})]}),e.jsx(H,{defaultChecked:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat Management"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{variant:"outline",className:"w-full justify-start",onClick:l,children:[e.jsx(fs,{className:"h-4 w-4 mr-2"}),"Export chat history"]}),e.jsxs(i,{variant:"outline",className:"w-full justify-start",onClick:m,children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"Archive chat"]}),e.jsxs(i,{variant:"destructive",className:"w-full justify-start",onClick:_,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Delete chat"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Chat Info"}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Chat ID:"}),e.jsxs("span",{className:"font-mono text-xs",children:[o.slice(0,8),"..."]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Created:"}),e.jsx("span",{children:"2 days ago"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Messages:"}),e.jsx("span",{children:"1,234"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Members:"}),e.jsx("span",{children:"5"})]})]})]})]}),e.jsx("div",{className:"flex gap-2 pt-4 border-t",children:e.jsx(i,{variant:"outline",onClick:s,className:"flex-1",children:"Close"})})]})})}const Es="https://your-project.supabase.co",zs="your-anon-key",J=ws(Es,zs);function ye(o){if(typeof o!="object"||o===null)return!1;const t=o;return typeof t.id=="string"&&typeof t.timestamp=="string"}function Ce(o){switch(o){case"message_reaction":case"typing_start":case"typing_stop":case"new_message":return o;default:return"new_message"}}class As{permissionGranted=!1;registration=null;async initialize(){if(!("Notification"in window)){console.warn("This browser does not support notifications");return}if("serviceWorker"in navigator)try{this.registration=await navigator.serviceWorker.register("/sw.js"),console.log("Service Worker registered successfully")}catch(t){console.error("Service Worker registration failed:",t)}if(Notification.permission==="default"){const t=await Notification.requestPermission();this.permissionGranted=t==="granted"}else this.permissionGranted=Notification.permission==="granted"}async requestPermission(){if(!("Notification"in window))return!1;const t=await Notification.requestPermission();return this.permissionGranted=t==="granted",this.permissionGranted}async showNotification(t){if(!this.permissionGranted){console.warn("Notification permission not granted");return}const s={body:t.message_preview||"New message",icon:t.sender_avatar||"/default-avatar.png",badge:"/badge.png",tag:`chat-${t.room_id}`,data:{room_id:t.room_id,sender_id:t.sender_id,type:t.type},actions:[{action:"reply",title:"Reply",icon:"/reply-icon.png"},{action:"mark_read",title:"Mark as Read",icon:"/mark-read-icon.png"}],requireInteraction:!1,silent:!1};try{const d=new Notification(`${t.sender_name} in ${t.room_name}`,s);d.onclick=()=>{window.focus(),window.dispatchEvent(new CustomEvent("navigateToChat",{detail:{roomId:t.room_id}})),d.close()},setTimeout(()=>{d.close()},5e3)}catch(d){console.error("Failed to show notification:",d)}}async sendPushNotification(t){if(!this.registration){console.warn("Service Worker not registered");return}try{await this.registration.showNotification(`${t.sender_name} in ${t.room_name}`,{body:t.message_preview||"New message",icon:t.sender_avatar||"/default-avatar.png",badge:"/badge.png",tag:`chat-${t.room_id}`,data:{room_id:t.room_id,sender_id:t.sender_id,type:t.type},actions:[{action:"reply",title:"Reply",icon:"/reply-icon.png"},{action:"mark_read",title:"Mark as Read",icon:"/mark-read-icon.png"}],requireInteraction:!1,silent:!1})}catch(s){console.error("Failed to send push notification:",s)}}async getNotifications(t){try{const{data:s,error:d}=await J.from("notifications").select("*").eq("user_id",t).eq("type","new_message").order("timestamp",{ascending:!1}).limit(50);if(d)throw d;return(Array.isArray(s)?s.filter(ye):[]).map(f=>{const g=Ce(f.type),p=f.action_data??{};return{id:f.id,type:g,room_id:p.room_id??"",room_name:p.room_name??"Unknown Room",sender_id:p.sender_id??"",sender_name:p.sender_name??"Unknown User",sender_avatar:f.avatar_url??void 0,message_preview:f.message??void 0,timestamp:f.timestamp,read:!!f.read}})}catch(s){return console.error("Failed to fetch notifications:",s),[]}}async markAsRead(t){try{const{error:s}=await J.from("notifications").update({read:!0}).eq("id",t);if(s)throw s}catch(s){console.error("Failed to mark notification as read:",s)}}async markAllAsRead(t){try{const{error:s}=await J.from("notifications").update({read:!0}).eq("user_id",t).eq("type","new_message");if(s)throw s}catch(s){console.error("Failed to mark all notifications as read:",s)}}async subscribeToNotifications(t,s){return J.channel(`notifications:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${t}`},async d=>{const x=d.new;if(!ye(x))return;const f=Ce(x.type);if(f==="new_message"){const g=x.action_data??{},p={id:x.id,type:f,room_id:g.room_id??"",room_name:g.room_name??"Unknown Room",sender_id:g.sender_id??"",sender_name:g.sender_name??"Unknown User",sender_avatar:x.avatar_url??void 0,message_preview:x.message??void 0,timestamp:x.timestamp,read:!!x.read};await this.showNotification(p),s(p)}}).subscribe()}isSupported(){return"Notification"in window}getPermissionStatus(){return Notification.permission}isPermissionGranted(){return this.permissionGranted}}const D=new As;function Fs({isOpen:o,onClose:t}){const[s,d]=c.useState([]),[x,f]=c.useState(!1),[g,p]=c.useState(!1);c.useEffect(()=>{u()},[]),c.useEffect(()=>{o&&N()},[o]);const u=async()=>{await D.initialize(),p(D.isPermissionGranted())},N=async()=>{f(!0);try{const l=await D.getNotifications("current-user-id");d(l)}catch(l){console.error("Failed to load notifications:",l)}finally{f(!1)}},C=async()=>{const l=await D.requestPermission();p(l)},k=async l=>{try{await D.markAsRead(l),d(m=>m.map(_=>_.id===l?{..._,read:!0}:_))}catch(m){console.error("Failed to mark as read:",m)}},w=async()=>{try{await D.markAllAsRead("current-user-id"),d(l=>l.map(m=>({...m,read:!0})))}catch(l){console.error("Failed to mark all as read:",l)}},E=async l=>{try{d(m=>m.filter(_=>_.id!==l))}catch(m){console.error("Failed to delete notification:",m)}},h=l=>{window.dispatchEvent(new CustomEvent("navigateToChat",{detail:{roomId:l.room_id}})),l.read||k(l.id),t()},v=s.filter(l=>!l.read).length;return o?e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end md:items-center justify-center",children:e.jsxs("div",{className:"bg-card border border-border rounded-t-2xl md:rounded-2xl w-full max-w-md max-h-[80vh] flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Notifications"}),v>0&&e.jsx(se,{variant:"destructive",className:"text-xs",children:v})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!g&&e.jsx(i,{variant:"outline",size:"sm",onClick:C,children:"Enable"}),e.jsx(i,{variant:"ghost",size:"icon",onClick:t,children:e.jsx(F,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:g?x?e.jsx("div",{className:"p-6 text-center",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading notifications..."})}):s.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-sm font-medium mb-2",children:"No notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You're all caught up! New notifications will appear here."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.length," notification",s.length!==1?"s":""]}),v>0&&e.jsxs(i,{variant:"ghost",size:"sm",onClick:w,children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Mark all read"]})]})}),e.jsx(ke,{className:"flex-1",children:e.jsx("div",{className:"space-y-1 p-2",children:s.map(l=>e.jsx("div",{className:`p-3 rounded-lg cursor-pointer transition-colors hover:bg-accent ${l.read?"":"bg-accent/50"}`,onClick:()=>h(l),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:l.sender_name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["in ",l.room_name]}),!l.read&&e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:l.message_preview}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:de(new Date(l.timestamp),{addSuffix:!0})})]}),e.jsxs($,{children:[e.jsx(O,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:m=>m.stopPropagation(),children:e.jsx(ce,{className:"h-3 w-3"})})}),e.jsxs(L,{align:"end",children:[!l.read&&e.jsxs(M,{onClick:m=>{m.stopPropagation(),k(l.id)},children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Mark as read"]}),e.jsxs(M,{onClick:m=>{m.stopPropagation(),E(l.id)},className:"text-destructive",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})},l.id))})})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Ae,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Notifications Disabled"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Enable notifications to receive updates about new messages and chat activity."}),e.jsx(i,{onClick:C,children:"Enable Notifications"})]})})]})}):null}function Ts({onBack:o}){const{user:t}=ne(),{currentRoom:s,messages:d,typingUsers:x,sendMessage:f,startTyping:g,stopTyping:p,markAsRead:u}=ie(),[N,C]=c.useState(""),[k,w]=c.useState(!1),[E,h]=c.useState(!1),[v,l]=c.useState(!1),m=c.useRef(null),_=c.useRef(null);c.useEffect(()=>{m.current?.scrollIntoView({behavior:"smooth"})},[d]),c.useEffect(()=>{const n=()=>{const y=window.innerHeight<500;l(y)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),c.useEffect(()=>{s&&u()},[s,u]);const T=async()=>{if(!(!N.trim()||!s))try{await f({roomId:s.id,body:N.trim()}),C("")}catch(n){console.error("Failed to send message:",n)}},b=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),T())},z=()=>{g()},r=()=>{p()},S=n=>n.roomType==="dm"?n.members.find(I=>I.userId!==t?.id)?.name||"Unknown User":n.name||"Group Chat",R=n=>n.roomType==="dm"?n.members.find(I=>I.userId!==t?.id)?.avatarUrl:n.avatarUrl,P=n=>n.authorId===t?.id,q=n=>de(new Date(n),{addSuffix:!0});return s?e.jsxs("div",{className:"flex flex-col h-full bg-background",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border bg-card",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:o,children:e.jsx(Fe,{className:"h-5 w-5"})}),e.jsxs(V,{className:"h-8 w-8",children:[e.jsx(Y,{src:R(s)}),e.jsx(Q,{className:"bg-primary text-white text-xs",children:S(s).charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium truncate",children:S(s)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.length>0?`${x.map(n=>n.userName).join(", ")} typing...`:`${s.members.filter(n=>n.isOnline).length} online`})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(re,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[d.length===0?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-accent flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-sm mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start the conversation by sending a message"})]})}):d.map(n=>e.jsx("div",{className:`flex ${P(n)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"max-w-[85%] group",children:[e.jsxs("div",{className:`rounded-2xl px-4 py-2 ${P(n)?"bg-primary text-white rounded-br-sm":"bg-accent text-foreground rounded-bl-sm"}`,children:[!P(n)&&e.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:n.authorName}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:n.content}),n.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:n.attachments.map(y=>e.jsx("div",{className:"max-w-xs",children:y.type==="image"?e.jsx("img",{src:y.url,alt:y.filename,className:"rounded-lg max-w-full h-auto"}):e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-black/10 rounded-lg",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs truncate",children:y.filename})]})},y.id))}),e.jsxs("p",{className:`text-xs mt-1 ${P(n)?"text-white/70":"text-muted-foreground"}`,children:[q(n.createdAt),n.isEdited&&" (edited)"]})]}),n.reactions.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1 ml-4",children:n.reactions.map(y=>e.jsxs(i,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs",children:[y.emoji," ",y.count]},y.emoji))})]})},n.id)),e.jsx("div",{ref:m})]}),e.jsxs("div",{className:`p-4 border-t border-border bg-card ${v?"pb-8":""}`,children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(B,{ref:_,type:"text",placeholder:"Type a message...",value:N,onChange:n=>C(n.target.value),onKeyPress:b,onFocus:z,onBlur:r,className:"rounded-xl pr-20"}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>w(!k),children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>h(!E),children:e.jsx(W,{className:"h-4 w-4"})})]})]}),e.jsx(i,{size:"icon",className:"rounded-xl flex-shrink-0",onClick:T,disabled:!N.trim(),children:e.jsx(Ie,{className:"h-4 w-4"})})]}),k&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Choose an emoji"}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>w(!1),children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"grid grid-cols-8 gap-1",children:["😀","😂","😍","🥰","😎","🤔","👍","👎","❤️","🔥","💯","🎉","👏","🙌","🤝","💪"].map((n,y)=>e.jsx(i,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-lg",onClick:()=>{C(I=>I+n),w(!1)},children:n},y))})]})}),E&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Upload Files"}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>h(!1),children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"File upload coming soon"})]})]})})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-accent flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-sm mb-2",children:"Chat not found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This chat room could not be loaded"})]})})}function Bs(){const{user:o}=ne(),{rooms:t,currentRoom:s,messages:d,typingUsers:x,isLoading:f,searchQuery:g,searchResults:p,setCurrentRoom:u,sendMessage:N,editMessage:C,deleteMessage:k,addReaction:w,startTyping:E,stopTyping:h,searchMessages:v,clearSearch:l}=ie(),[m,_]=c.useState(""),[T,b]=c.useState(null),[z,r]=c.useState(""),[S,R]=c.useState(!1),[P,q]=c.useState(!1),[n,y]=c.useState(null),[I,Ue]=c.useState(!1),[Pe,ae]=c.useState(!1),[De,me]=c.useState(!1),[Ge,he]=c.useState(!1),[$e,Oe]=c.useState(!1),xe=c.useRef(null),ue=c.useRef(null);c.useEffect(()=>{xe.current?.scrollIntoView({behavior:"smooth"})},[d]),c.useEffect(()=>{const a=()=>{Oe(window.innerWidth<768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),c.useEffect(()=>{const a=()=>E(),j=()=>h(),A=ue.current;return A&&(A.addEventListener("keydown",a),A.addEventListener("keyup",j)),()=>{A&&(A.removeEventListener("keydown",a),A.removeEventListener("keyup",j))}},[E,h]);const fe=async()=>{if(!(!m.trim()||!s))try{await N({roomId:s.id,body:m.trim(),replyTo:n?.id}),_(""),y(null)}catch(a){console.error("Failed to send message:",a)}},Le=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),fe())},Be=async a=>{if(z.trim())try{await C(a,z.trim()),b(null),r("")}catch(j){console.error("Failed to edit message:",j)}},qe=async a=>{if(confirm("Are you sure you want to delete this message?"))try{await k(a)}catch(j){console.error("Failed to delete message:",j)}},Ke=async(a,j)=>{try{await w(a,j)}catch(A){console.error("Failed to add reaction:",A)}},We=async a=>{if(!(!s||a.length===0))try{await N({roomId:s.id,attachments:a}),q(!1)}catch(j){console.error("Failed to upload files:",j)}},je=a=>de(new Date(a),{addSuffix:!0}),X=a=>a.roomType==="dm"?a.members.find(A=>A.userId!==o?.id)?.name||"Unknown User":a.name||"Group Chat",pe=a=>a.roomType==="dm"?a.members.find(A=>A.userId!==o?.id)?.avatarUrl:a.avatarUrl,K=a=>a.authorId===o?.id,ge=()=>I&&g?p:d;return $e&&s?e.jsx(Ts,{onBack:()=>u(null)}):e.jsxs("div",{className:"max-w-6xl mx-auto px-4 pt-6 pb-20 md:pb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 h-[calc(100vh-200px)] md:h-[calc(100vh-160px)] border border-border rounded-2xl overflow-hidden bg-card",children:[e.jsxs("div",{className:`border-r border-border ${s!==null?"hidden md:block":"block"}`,children:[e.jsxs("div",{className:"p-4 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Messages"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Ue(!I),children:e.jsx(U,{className:"h-4 w-4"})}),e.jsxs($,{children:[e.jsx(O,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(re,{className:"h-4 w-4"})})}),e.jsxs(L,{align:"end",children:[e.jsxs(M,{onClick:()=>ae(!0),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Create Group"]}),e.jsxs(M,{onClick:()=>he(!0),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Notifications"]})]})]})]})]}),I&&e.jsxs("div",{className:"relative mb-3",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{type:"text",placeholder:"Search messages...",value:g,onChange:a=>v(a.target.value),className:"pl-10 rounded-xl"}),g&&e.jsx(i,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6",onClick:l,children:e.jsx(F,{className:"h-3 w-3"})})]})]}),e.jsx("div",{className:"overflow-y-auto",children:f?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Loading conversations..."}):t.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"No conversations yet"}):t.map(a=>e.jsxs("button",{onClick:()=>u(a),className:`w-full p-4 flex items-start gap-3 hover:bg-accent transition-colors border-b border-border ${s?.id===a.id?"bg-accent":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs(V,{className:"w-12 h-12",children:[e.jsx(Y,{src:pe(a)}),e.jsx(Q,{className:"bg-primary text-white",children:X(a).charAt(0)})]}),a.members.some(j=>j.isOnline&&j.userId!==o?.id)&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-card"})]}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-sm font-medium truncate",children:X(a)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.lastMessageAt?je(a.lastMessageAt):"—"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.lastMessageAt?"Last message...":"No messages yet"}),a.unreadCount>0&&e.jsx(se,{variant:"default",className:"ml-2 text-xs px-2 py-0.5",children:a.unreadCount})]})]})]},a.id))})]}),e.jsx("div",{className:`md:col-span-2 flex flex-col ${s===null?"hidden md:flex":"flex"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center gap-3",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"md:hidden rounded-xl",onClick:()=>u(null),children:e.jsx(Fe,{className:"h-5 w-5"})}),e.jsxs(V,{className:"w-10 h-10",children:[e.jsx(Y,{src:pe(s)}),e.jsx(Q,{className:"bg-primary text-white",children:X(s).charAt(0)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:X(s)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.length>0?`${x.map(a=>a.userName).join(", ")} typing...`:`${s.members.filter(a=>a.isOnline).length} online`})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"rounded-xl",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"rounded-xl",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsxs($,{children:[e.jsx(O,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"rounded-xl",children:e.jsx(re,{className:"h-4 w-4"})})}),e.jsxs(L,{align:"end",children:[e.jsx(M,{children:"View Profile"}),e.jsxs(M,{onClick:()=>me(!0),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Chat Settings"]}),e.jsxs(M,{onClick:()=>ae(!0),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Manage Group"]}),e.jsx(M,{children:"Mute Notifications"}),e.jsx(M,{children:"Clear Chat"})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[f?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading messages..."})}):ge().length===0?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-accent flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-sm mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Start the conversation by sending a message"})]})}):ge().map(a=>e.jsx("div",{className:`flex ${K(a)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"max-w-[70%] group",children:[a.replyTo&&e.jsx("div",{className:"mb-2 ml-4 p-2 bg-muted rounded-lg border-l-2 border-primary",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Replying to message"})}),e.jsxs("div",{className:`rounded-2xl px-4 py-2 ${K(a)?"bg-primary text-white rounded-br-sm":"bg-accent text-foreground rounded-bl-sm"}`,children:[!K(a)&&e.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:a.authorName}),T===a.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(rs,{value:z,onChange:j=>r(j.target.value),className:"min-h-[60px] resize-none",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{size:"sm",onClick:()=>Be(a.id),className:"h-8",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"Save"]}),e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>{b(null),r("")},className:"h-8",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Cancel"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:a.content}),a.attachments.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:a.attachments.map(j=>e.jsx("div",{className:"max-w-xs",children:j.type==="image"?e.jsx("img",{src:j.url,alt:j.filename,className:"rounded-lg max-w-full h-auto"}):e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-black/10 rounded-lg",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs truncate",children:j.filename})]})},j.id))}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("p",{className:`text-xs ${K(a)?"text-white/70":"text-muted-foreground"}`,children:[je(a.createdAt),a.isEdited&&" (edited)"]}),K(a)&&e.jsxs($,{children:[e.jsx(O,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ps,{className:"h-3 w-3"})})}),e.jsxs(L,{align:"end",children:[e.jsxs(M,{onClick:()=>{b(a.id),r(a.content||"")},children:[e.jsx(gs,{className:"h-3 w-3 mr-2"}),"Edit"]}),e.jsxs(M,{onClick:()=>qe(a.id),children:[e.jsx(oe,{className:"h-3 w-3 mr-2"}),"Delete"]}),e.jsxs(M,{onClick:()=>{navigator.clipboard.writeText(a.content||"")},children:[e.jsx(Ns,{className:"h-3 w-3 mr-2"}),"Copy"]})]})]})]})]})]}),a.reactions.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1 ml-4",children:a.reactions.map(j=>e.jsxs(i,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>Ke(a.id,j.emoji),children:[j.emoji," ",j.count]},j.emoji))})]})},a.id)),e.jsx("div",{ref:xe})]}),n&&e.jsxs("div",{className:"p-3 border-t border-border bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Replying to ",n.authorName]})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>y(null),children:e.jsx(F,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:n.content})]}),e.jsxs("div",{className:"p-4 border-t border-border",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(B,{ref:ue,type:"text",placeholder:"Type a message...",value:m,onChange:a=>_(a.target.value),onKeyPress:Le,className:"rounded-xl pr-20"}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>R(!S),children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>q(!P),children:e.jsx(W,{className:"h-4 w-4"})})]})]}),e.jsx(i,{size:"icon",className:"rounded-xl flex-shrink-0",onClick:fe,disabled:!m.trim(),children:e.jsx(Ie,{className:"h-4 w-4"})})]}),S&&e.jsx("div",{className:"mt-2",children:e.jsx(bs,{onEmojiSelect:a=>{_(j=>j+a),R(!1)},onClose:()=>R(!1)})}),P&&e.jsx("div",{className:"mt-2",children:e.jsx(ks,{onFilesSelect:We,onClose:()=>q(!1)})})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-center p-8",children:e.jsxs("div",{children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-accent flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-sm mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a conversation from the list to start chatting"})]})})})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx(Ss,{roomId:s.id,isOpen:Pe,onClose:()=>ae(!1)}),e.jsx(_s,{roomId:s.id,isOpen:De,onClose:()=>me(!1)})]}),e.jsx(Fs,{isOpen:Ge,onClose:()=>he(!1)})]})}export{Bs as ChatPage};
